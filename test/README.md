# openstack-network-exporter-test

## Introduction

Functional test cases for openstack-network-exporter.

It will create a OVS-DPDK bridge together to openstack-network-exporter.
Traffic will be injected and statistics generated by openstack-network-exporter
will be checked.

## How to use it

Steps:

1. Configure the environment:

   ```bash
   ./test/config_test_environment.sh
   ```

   It will configure an OVS bridge and 2 namespaces connected to the OVS bridge

2. Run all test cases:

   ```bash
   for t in ./test/test_*.sh; do bash -xe "$t"; done
   ```

## Alert rule tests

The `alert_rules_test.yaml` file contains unit tests for the Prometheus
alerting rules in `rules/`. These tests validate that alerts fire correctly
given specific metric values.

The `test4_alert_rules.sh` script runs these tests as part of the CI pipeline.
It is executed automatically by `make test`.

### Prerequisites

Install `promtool` (part of Prometheus):

```bash
# Fedora
dnf install golang-github-prometheus

# Debian/Ubuntu
apt install prometheus

# Or download standalone binary from:
# https://prometheus.io/download/
```

### Running alert tests manually

From the repository root:

```bash
promtool test rules test/alert_rules_test.yaml
```

Or via the test script:

```bash
bash test/test4_alert_rules.sh
```

This will output SUCCESS/FAILED without needing a running Prometheus instance.

## Configuration files

Configuration files are used:

### `stats_conf.csv`

Contains a list of statistics to skip (due to some issues with those stats) or
a new threshold to compare values for those statistics if there is a huge
variability in their values.
